# AWS Well-Architected Framework - 6つの柱詳細ガイド

このドキュメントは、AWS Well-Architected Frameworkの6つの柱の詳細な説明と、具体的な評価基準を提供します。

## 目次

1. [運用の優秀性 (Operational Excellence)](#運用の優秀性-operational-excellence)
2. [セキュリティ (Security)](#セキュリティ-security)
3. [信頼性 (Reliability)](#信頼性-reliability)
4. [パフォーマンス効率 (Performance Efficiency)](#パフォーマンス効率-performance-efficiency)
5. [コスト最適化 (Cost Optimization)](#コスト最適化-cost-optimization)
6. [持続可能性 (Sustainability)](#持続可能性-sustainability)

---

## 運用の優秀性 (Operational Excellence)

### 定義

運用の優秀性の柱は、ビジネス価値を提供し、サポートプロセスと手順を継続的に改善する組織の能力に焦点を当てています。

### 設計原則

1. **コードとして運用を実行**: Infrastructure as Code（IaC）を使用してリソース管理を自動化
2. **小規模で頻繁な変更**: 大規模な変更ではなく、小さな変更を頻繁に実施
3. **運用手順を頻繁に改善**: 定期的に手順をレビューし、改善
4. **障害を予測**: 障害シナリオを特定し、対応手順を準備
5. **運用上のすべての障害から学習**: インシデントから学び、再発防止策を実装

### 具体的な評価項目

#### 1. 運用の準備状況

**ベストプラクティス**:
- ワークロードの運用優先度を決定
- 運用手順を文書化し、定期的に更新
- リソースのタグ付け戦略を実装（環境、所有者、コスト配分）
- Infrastructure as Code（CloudFormation/CDK）を使用

**評価基準**:
- タグ付けカバレッジ: 80%以上のリソースに必須タグが付与されているか
- IaC カバレッジ: 主要インフラの80%以上がコード管理されているか
- ドキュメンテーション: 運用手順書、障害対応手順書が整備されているか

#### 2. 運用の実行

**ベストプラクティス**:
- ワークロードの健全性を理解
- 運用の健全性を理解
- イベントへの対応を管理

**評価基準**:
- CloudWatch Logs の有効化率: 90%以上のサービスでロギングが有効か
- メトリクスとアラーム: 主要な KPI に CloudWatch Alarms が設定されているか
- インシデント対応時間: 平均検出時間（MTTD）、平均復旧時間（MTTR）が測定されているか

**推奨ツール**:
- AWS Systems Manager: パッチ管理、運用タスクの自動化
- AWS CloudWatch: メトリクス、ログ、アラーム
- AWS X-Ray: 分散トレーシング
- AWS Config: リソース構成管理、コンプライアンス監視

#### 3. 運用の進化

**ベストプラクティス**:
- フィードバックループの確立
- 継続的な改善文化の醸成
- 運用メトリクスの定期的なレビュー

**評価基準**:
- ポストモーテムの実施率: インシデント発生時に100%実施されているか
- 改善アクションの完了率: 特定された改善アクションの80%以上が実装されているか
- 自動化率: 繰り返し作業の70%以上が自動化されているか

---

## セキュリティ (Security)

### 定義

セキュリティの柱は、データ、システム、資産を保護し、クラウドテクノロジーを活用してセキュリティを向上させる能力に焦点を当てています。

### 設計原則

1. **強力なアイデンティティ基盤を実装**: 最小権限の原則、職務分離の実装
2. **トレーサビリティを有効化**: すべてのアクションをログに記録し、監査
3. **すべてのレイヤーでセキュリティを適用**: 多層防御戦略
4. **セキュリティのベストプラクティスを自動化**: 自動化されたセキュリティチェック
5. **転送中および保管中のデータを保護**: 暗号化の標準適用
6. **データに直接人がアクセスしないようにする**: 自動化されたプロセスを優先
7. **セキュリティイベントに備える**: インシデント対応計画の策定と訓練

### 具体的な評価項目

#### 1. アイデンティティとアクセス管理

**ベストプラクティス**:
- IAM ロールを使用（アクセスキーは避ける）
- 最小権限の原則を適用
- MFA を有効化（すべての人間ユーザー）
- パスワードポリシーを強化

**評価基準**:
- IAM ユーザー数: サービスアカウント以外の IAM ユーザー数を最小化
- MFA 有効化率: 人間ユーザーの100%で MFA 有効化
- 未使用の認証情報: 90日以上使用されていないアクセスキーがないか
- ルートアカウント使用: ルートアカウントの使用が監視されているか

**具体的なチェック**:
```bash
# 未使用の認証情報を確認
aws iam generate-credential-report
aws iam get-credential-report

# MFA 有効化状況を確認
aws iam get-account-summary
```

#### 2. 検知

**ベストプラクティス**:
- AWS CloudTrail ですべてのAPIコールを記録
- Amazon GuardDuty で脅威検出
- AWS Config でコンプライアンス監視
- VPC Flow Logs でネットワークトラフィック監視

**評価基準**:
- CloudTrail 有効化: すべてのリージョンで有効か
- GuardDuty 有効化: 有効かつアラート設定済みか
- Config ルール: 主要なセキュリティ要件が Config ルールで監視されているか
- ログの保管期間: 90日以上保管されているか（コンプライアンス要件に応じて）

**推奨 Config ルール**:
- `s3-bucket-public-read-prohibited`
- `s3-bucket-public-write-prohibited`
- `rds-storage-encrypted`
- `ec2-encrypted-volumes`
- `iam-password-policy`

#### 3. インフラストラクチャ保護

**ベストプラクティス**:
- VPC でネットワークを分離
- セキュリティグループで最小権限のアクセス制御
- AWS WAF で Web アプリケーション保護
- AWS Shield でDDoS攻撃対策

**評価基準**:
- パブリックサブネット: 必要最小限のリソースのみ配置されているか
- セキュリティグループ: 0.0.0.0/0 からの不要なアクセスがないか
- WAF 有効化: 公開 API/Web サイトで有効化されているか
- ELB セキュリティポリシー: TLS 1.2 以上が強制されているか

**具体的なチェック**:
```bash
# パブリックアクセス可能なセキュリティグループを確認
aws ec2 describe-security-groups \
  --filters Name=ip-permission.cidr,Values='0.0.0.0/0' \
  --query 'SecurityGroups[*].[GroupId,GroupName]'
```

#### 4. データ保護

**ベストプラクティス**:
- すべてのデータを暗号化（転送時・保管時）
- S3 バケットのバージョニング有効化
- S3 パブリックアクセスブロック有効化
- RDS/EBS の暗号化有効化

**評価基準**:
- S3 暗号化率: 100%のバケットで暗号化が有効か
- RDS 暗号化率: 100%のインスタンスで暗号化が有効か
- バックアップ暗号化: すべてのバックアップが暗号化されているか
- KMS キー管理: カスタマー管理キーが適切にローテーションされているか

#### 5. インシデント対応

**ベストプラクティス**:
- インシデント対応計画の策定
- 定期的なインシデント対応訓練
- AWS Security Hub で一元管理
- 自動対応の実装（EventBridge + Lambda）

**評価基準**:
- インシデント対応手順書: 整備されているか
- 訓練実施頻度: 年2回以上実施されているか
- 自動対応率: セキュリティアラートの50%以上が自動対応可能か

---

## 信頼性 (Reliability)

### 定義

信頼性の柱は、ワークロードが意図された機能を正しく一貫して実行し、障害から迅速に回復する能力に焦点を当てています。

### 設計原則

1. **障害から自動的に復旧**: 障害を監視し、自動的に復旧
2. **復旧手順をテスト**: 定期的に障害シナリオをテスト
3. **水平スケーリング**: 単一の大きなリソースではなく、複数の小さなリソース
4. **キャパシティを推測しない**: Auto Scaling で需要に追従
5. **オートメーションで変更を管理**: Infrastructure as Code で変更を制御

### 具体的な評価項目

#### 1. 基盤

**ベストプラクティス**:
- AWS Service Quotas でクォータを監視
- ネットワークトポロジを適切に設計
- マルチAZ/マルチリージョンを活用

**評価基準**:
- VPC 設計: パブリック/プライベートサブネットが適切に分離されているか
- サービスクォータ監視: 主要なクォータが80%を超えた場合のアラート設定
- DNS フェイルオーバー: Route 53 ヘルスチェックとフェイルオーバー設定

#### 2. ワークロードアーキテクチャ

**ベストプラクティス**:
- ステートレスなアプリケーション設計
- 適切なロードバランシング
- マイクロサービスアーキテクチャの採用

**評価基準**:
- シングルポイントオブフェイル:ありません
- ロードバランサー: 適切なヘルスチェック設定
- Auto Scaling: 需要に応じたスケーリング設定

#### 3. 変更管理

**ベストプラクティス**:
- Infrastructure as Code で変更を管理
- デプロイメントの自動化
- ブルー/グリーンデプロイメント、カナリアデプロイメント

**評価基準**:
- デプロイ自動化率: 80%以上のデプロイが自動化されているか
- ロールバック手順: すべてのデプロイにロールバック手順が整備されているか
- 変更追跡: すべての変更が CloudTrail、Config で追跡されているか

#### 4. 障害管理

**ベストプラクティス**:
- データのバックアップ
- 障害分離境界の使用（Multi-AZ、Multi-Region）
- 定期的な復旧訓練

**評価基準**:
- バックアップ頻度: データベースの自動バックアップが毎日実施されているか
- バックアップテスト: 四半期に1回以上、復元テストが実施されているか
- RTO/RPO 目標: 定義され、定期的に測定されているか
- Multi-AZ カバレッジ: 本番環境の主要リソースが Multi-AZ 構成か

**具体的な設定例（RDS）**:
```typescript
const database = new rds.DatabaseInstance(this, 'Database', {
  engine: rds.DatabaseInstanceEngine.postgres({ version: rds.PostgresEngineVersion.VER_15_3 }),
  multiAz: true, // Multi-AZ 有効化
  backupRetention: cdk.Duration.days(7), // 7日間保持
  deleteAutomatedBackups: false, // バックアップ保持
});
```

---

## パフォーマンス効率 (Performance Efficiency)

### 定義

パフォーマンス効率の柱は、要件を満たすためにコンピューティングリソースを効率的に使用し、需要の変化や技術の進化に応じて効率性を維持する能力に焦点を当てています。

### 設計原則

1. **高度なテクノロジーを民主化**: 複雑な技術をサービスとして利用
2. **数分でグローバル展開**: マルチリージョンで低レイテンシを実現
3. **サーバーレスアーキテクチャを使用**: 運用負荷を削減
4. **より頻繁に実験**: 低コストで新しい技術を試す
5. **メカニカルシンパシー**: 適切な技術選択

### 具体的な評価項目

#### 1. 選択

**ベストプラクティス**:
- コンピューティングリソースの適切な選択（EC2 インスタンスタイプ、Lambda 等）
- ストレージソリューションの最適化
- データベースソリューションの選択
- ネットワークトポロジの最適化

**評価基準**:
- インスタンスタイプ: CPU/メモリ使用率が適切か（過剰プロビジョニング検出）
- ストレージタイプ: ワークロードに適したストレージタイプか（SSD vs HDD、S3 ストレージクラス）
- データベースタイプ: リレーショナル vs NoSQL の選択が適切か

**具体的なチェック**:
- CPU 使用率: 平均40-70%が理想（低すぎる場合は過剰プロビジョニング）
- メモリ使用率: 平均60-80%が理想
- ディスクI/O: IOPS が制限に達していないか

#### 2. レビュー

**ベストプラクティス**:
- 定期的なパフォーマンスレビュー
- 新しいAWSサービスや機能の評価
- ベンチマークテストの実施

**評価基準**:
- Performance Insights: RDS Performance Insights が有効化されているか
- X-Ray: 分散トレーシングが有効化されているか
- ベンチマーク: 定期的なパフォーマンステストが実施されているか

**推奨ツール**:
- AWS Compute Optimizer: EC2、Lambda のサイズ最適化推奨
- RDS Performance Insights: データベースパフォーマンス分析
- CloudWatch Container Insights: ECS/EKS のパフォーマンス監視

#### 3. モニタリング

**ベストプラクティス**:
- アプリケーションレベルのメトリクス収集
- エンドユーザーエクスペリエンスの監視
- レイテンシとスループットの監視

**評価基準**:
- カスタムメトリクス: ビジネスKPIがCloudWatchに送信されているか
- APM ツール: X-Ray または他の APM ツールが統合されているか
- Synthetic Monitoring: CloudWatch Synthetics でエンドポイント監視されているか

#### 4. トレードオフ

**ベストプラクティス**:
- 整合性、耐久性、スペース vs 時間、レイテンシのトレードオフ
- キャッシング戦略の実装

**評価基準**:
- CDN: CloudFront が適切に活用されているか
- キャッシュ: ElastiCache（Redis/Memcached）が活用されているか
- データベースキャッシュ: クエリ結果キャッシュ、レプリケーションラグ許容

**具体的な最適化例**:
- CloudFront + S3 で静的コンテンツ配信
- ElastiCache で頻繁にアクセスされるデータをキャッシュ
- DynamoDB DAX でマイクロ秒レイテンシを実現
- RDS Read Replica で読み取り負荷を分散

---

## コスト最適化 (Cost Optimization)

### 定義

コスト最適化の柱は、システムがビジネス成果を達成しながら、最も低い価格で提供できる能力に焦点を当てています。

### 設計原則

1. **クラウド財務管理を実装**: FinOps 文化の確立
2. **消費モデルを採用**: 使用した分だけ支払い
3. **全体的な効率を測定**: メトリクスでビジネス価値を測定
4. **差別化につながらない重労働に費用をかけない**: マネージドサービスを活用
5. **費用を分析して帰属させる**: タグベースのコスト配分

### 具体的な評価項目

#### 1. クラウド財務管理の実践

**ベストプラクティス**:
- Cost Explorer でコスト分析
- Budgets でコストアラート設定
- Cost Anomaly Detection で異常検知
- タグベースのコスト配分

**評価基準**:
- タグ付けカバレッジ: 80%以上のリソースにコストセンタータグが付与されているか
- Budget 設定: プロジェクト/環境ごとに予算が設定されているか
- コストレポート: 月次でコストレポートが作成されているか

**推奨タグ戦略**:
- `CostCenter`: コストセンター
- `Project`: プロジェクト名
- `Environment`: 本番/ステージング/開発
- `Owner`: 所有者

#### 2. 費用対効果の高いリソース

**ベストプラクティス**:
- Savings Plans、Reserved Instances の活用
- Spot Instances の活用
- 適切なインスタンスタイプの選択
- ライセンス最適化

**評価基準**:
- Savings Plans カバレッジ: EC2、Lambda 使用量の60%以上がカバーされているか
- Spot Instance 使用率: バッチ処理、開発環境で Spot が活用されているか
- RI 使用率: 購入した RI が90%以上使用されているか

**コスト削減例**:
- オンデマンド EC2 → Reserved Instances: 最大72%削減
- オンデマンド EC2 → Spot Instances: 最大90%削減
- S3 Standard → S3 Intelligent-Tiering: 最大70%削減
- S3 Standard → S3 Glacier: 最大95%削減

**具体的なチェック**:
```bash
# RI カバレッジを確認
aws ce get-reservation-coverage \
  --time-period Start=2024-01-01,End=2024-01-31 \
  --granularity MONTHLY

# Savings Plans 使用率を確認
aws ce get-savings-plans-utilization \
  --time-period Start=2024-01-01,End=2024-01-31
```

#### 3. 需要と供給の一致

**ベストプラクティス**:
- Auto Scaling で需要に追従
- Lambda、Fargate でサーバーレス化
- スケジュールベースのスケーリング

**評価基準**:
- Auto Scaling カバレッジ: EC2、ECS の80%以上で Auto Scaling 設定
- Lambda 活用率: 短時間・不定期タスクで Lambda が活用されているか
- スケジュール停止: 開発/ステージング環境が夜間・週末に停止されているか

**コスト削減例**:
- 営業時間外の EC2 停止: 月額コスト60%削減
- Lambda 化（1日1回実行のバッチ）: EC2 比で95%削減

#### 4. 継続的な最適化

**ベストプラクティス**:
- 未使用リソースの定期的な棚卸し
- Trusted Advisor 推奨事項の確認
- AWS Compute Optimizer の活用

**評価基準**:
- 未使用リソース: 未使用 EIP、EBS ボリューム、古いスナップショットがないか
- 右サイズ化: Compute Optimizer の推奨事項が定期的にレビューされているか
- ストレージライフサイクル: S3 ライフサイクルポリシーが設定されているか

**よくある無駄なコスト**:
- 未使用 Elastic IP: 月額$3.6（アタッチされていない場合）
- 古い EBS スナップショット: 不要なスナップショットの削除で月額数百ドル削減
- 過剰プロビジョニング: CPU 使用率10%未満の EC2 インスタンス
- データ転送: 不要なクロスリージョン/インターネット転送

**具体的なチェック**:
```bash
# 未使用 Elastic IP を確認
aws ec2 describe-addresses \
  --query 'Addresses[?AssociationId==null].[PublicIp,AllocationId]'

# 90日以上古いスナップショットを確認
aws ec2 describe-snapshots --owner-ids self \
  --query 'Snapshots[?StartTime<=`2023-10-01`].[SnapshotId,StartTime,VolumeSize]'
```

---

## 持続可能性 (Sustainability)

### 定義

持続可能性の柱は、ビジネス価値を最大化し、クラウドワークロードの実行による環境への影響を最小化することに焦点を当てています。2021年12月にAWS Well-Architected Frameworkに追加された6番目の柱です。

### 設計原則

1. **影響を理解する**: ワークロードの環境への影響を測定し、改善目標を設定
2. **持続可能性目標を確立**: 長期的な持続可能性目標を設定し、進捗を追跡
3. **使用率を最大化**: リソースの使用率を最大化し、無駄を削減
4. **新しいハードウェアとソフトウェアを予測**: エネルギー効率の高い新技術を採用
5. **マネージドサービスを使用**: 運用負荷を削減し、効率的なリソース利用を実現
6. **クラウドワークロードの下流への影響を削減**: 顧客のエネルギー消費を削減

### 具体的な評価項目

#### 1. リージョン選択

**ベストプラクティス**:
- 再生可能エネルギー比率が高いリージョンを選択
- ユーザーとの距離とエネルギー効率のバランスを考慮
- AWS Customer Carbon Footprint Tool で炭素排出量を追跡

**評価基準**:
- 再生可能エネルギー比率: AWS のクリーンエネルギー目標に沿ったリージョン選択
- データ重力: ユーザーに近いリージョンでレイテンシとデータ転送を削減
- 炭素排出量測定: Carbon Footprint Tool が定期的に確認されているか

**推奨リージョン（再生可能エネルギー比率が高い）**:
- us-west-2 (オレゴン): 100%再生可能エネルギー目標
- eu-central-1 (フランクフルト): 高い再生可能エネルギー比率
- ca-central-1 (カナダ): クリーンエネルギー中心

#### 2. リソースの適切なサイジング

**ベストプラクティス**:
- AWS Compute Optimizer でリソースサイジングを最適化
- 使用率の低いリソースを削減
- サーバーレスアーキテクチャで未使用リソースを削減

**評価基準**:
- インスタンス使用率: CPU/メモリ使用率が40%以上（過剰プロビジョニング回避）
- アイドル時間: 24時間稼働の必要がないリソースは適切に停止されているか
- サーバーレス化率: 断続的なワークロードで Lambda/Fargate が活用されているか

**具体的なチェック**:
```bash
# Compute Optimizer の推奨事項を確認
aws compute-optimizer get-ec2-instance-recommendations
aws compute-optimizer get-lambda-function-recommendations

# 低使用率インスタンスを特定（CPU使用率 < 40%）
aws cloudwatch get-metric-statistics \
  --namespace AWS/EC2 \
  --metric-name CPUUtilization \
  --start-time $(date -u -d '7 days ago' +%Y-%m-%dT%H:%M:%S) \
  --end-time $(date -u +%Y-%m-%dT%H:%M:%S) \
  --period 86400 \
  --statistics Average
```

#### 3. データ管理とストレージ最適化

**ベストプラクティス**:
- S3 Intelligent-Tiering でストレージコストとエネルギーを削減
- 不要なデータを定期的に削除
- データ圧縮とデータ重複排除を実装

**評価基準**:
- ストレージライフサイクル: S3 ライフサイクルポリシーが設定されているか
- データ保持ポリシー: 不要なデータが90日以内に削除されているか
- 圧縮率: ログ、バックアップが圧縮されているか

**具体的な最適化例**:
- S3 Standard → S3 Intelligent-Tiering: アクセスパターンに応じた自動最適化
- EBS gp2 → gp3: 同じパフォーマンスで20%エネルギー削減
- 古いスナップショット削除: ストレージ使用量を削減

```typescript
// S3 ライフサイクルポリシー例
const bucket = new s3.Bucket(this, 'Bucket', {
  lifecycleRules: [
    {
      transitions: [
        {
          storageClass: s3.StorageClass.INTELLIGENT_TIERING,
          transitionAfter: cdk.Duration.days(0), // 即座に移行
        },
      ],
    },
    {
      expiration: cdk.Duration.days(365), // 1年後に削除
      prefix: 'logs/',
    },
  ],
});
```

#### 4. ハードウェアとソフトウェアの効率

**ベストプラクティス**:
- Graviton プロセッサ（ARM ベース）の活用
- 最新世代のインスタンスタイプの使用
- 効率的なアルゴリズムとコードの最適化

**評価基準**:
- Graviton 使用率: EC2、RDS、ECS で Graviton インスタンスが活用されているか
- インスタンス世代: 最新世代のインスタンス（例: m7g、c7g）が使用されているか
- コード効率: プロファイリングツールでボトルネックが特定・改善されているか

**Graviton による改善例**:
- m6g (Graviton) vs m5: 最大40%優れた価格性能比、60%少ないエネルギー消費
- r6g (Graviton) vs r5: メモリ集約型ワークロードで大幅な効率改善

**具体的な移行例（RDS）**:
```typescript
const database = new rds.DatabaseInstance(this, 'Database', {
  engine: rds.DatabaseInstanceEngine.postgres({ version: rds.PostgresEngineVersion.VER_15_3 }),
  instanceType: ec2.InstanceType.of(
    ec2.InstanceClass.M6G, // Graviton プロセッサ
    ec2.InstanceSize.XLARGE
  ),
});
```

#### 5. エネルギー効率の高いアーキテクチャパターン

**ベストプラクティス**:
- イベント駆動アーキテクチャ（常時稼働を回避）
- キャッシング戦略でコンピューティングを削減
- 非同期処理でリソース使用を最適化

**評価基準**:
- Lambda 使用率: 短時間・不定期タスクで Lambda が活用されているか
- キャッシュヒット率: CloudFront、ElastiCache のヒット率が80%以上か
- 非同期処理率: バッチ処理が SQS/EventBridge で非同期実行されているか

**エネルギー効率の高いパターン例**:
- **イベント駆動**: EventBridge + Lambda（常時稼働 EC2 の代替）
- **CDN**: CloudFront でオリジンへのリクエストを90%削減
- **キャッシング**: ElastiCache で DB 負荷を70%削減
- **非同期処理**: SQS で処理を平準化し、スパイク時の過剰リソースを回避

#### 6. 開発とデプロイメントの最適化

**ベストプラクティス**:
- 開発/テスト環境を最小限のリソースで構築
- 非営業時間は環境を自動停止
- CI/CD パイプラインの効率化

**評価基準**:
- 環境分離: 本番と同じサイズの開発環境がないか
- スケジュール停止: 開発環境が夜間・週末に自動停止されているか
- パイプライン効率: CI/CD ビルド時間が最小化されているか

**具体的な最適化例**:
```bash
# EventBridge で夜間・週末に EC2 を自動停止
aws events put-rule --name stop-dev-instances \
  --schedule-expression "cron(0 20 ? * MON-FRI *)"

aws events put-targets --rule stop-dev-instances \
  --targets "Id"="1","Arn"="arn:aws:ssm:region:account:automation-definition/AWS-StopEC2Instance"
```

**開発環境のエネルギー削減例**:
- 夜間停止（12時間/日）: 月額コスト・エネルギー50%削減
- 週末停止: さらに29%削減
- 本番の1/2サイズに縮小: リソース使用量50%削減

---

このガイドを参照して、各柱の詳細な評価を実施してください。評価時は、必ず最新のAWS公式ドキュメントと照合することを推奨します。
