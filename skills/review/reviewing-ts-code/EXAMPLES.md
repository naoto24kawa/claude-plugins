# コードレビューの良い例・悪い例

このドキュメントは、reviewing-code スキルの効果的な使用方法を具体例で示します。

---

## 目次

1. [レビュー依頼の良い例・悪い例](#レビュー依頼の良い例悪い例)
2. [対象指定の良い例・悪い例](#対象指定の良い例悪い例)
3. [期待値設定の良い例・悪い例](#期待値設定の良い例悪い例)
4. [改善実施の良い例・悪い例](#改善実施の良い例悪い例)

---

## レビュー依頼の良い例・悪い例

### ❌ 悪い例 1: 曖昧な依頼

```
ユーザー: コードをレビューして
```

**問題点**:

- 対象が不明確
- レビューの目的が不明
- 期待する成果物が不明確

### ✅ 良い例 1: 明確な依頼

```
ユーザー: src/services/auth-service.ts をレビューしてください。
新しい認証機能を実装したので、セキュリティ面と設計面での問題がないか確認したいです。
```

**優れている点**:

- 対象ファイルが明確
- レビューの目的（セキュリティと設計）が明示
- 実装背景が説明されている

---

### ❌ 悪い例 2: 範囲が広すぎる

```
ユーザー: プロジェクト全体をレビューして
```

**問題点**:

- 範囲が広すぎて焦点が定まらない
- レビューに時間がかかりすぎる
- 優先順位が不明確

### ✅ 良い例 2: 適切な範囲設定

```
ユーザー: src/api/ ディレクトリ配下のファイルをレビューしてください。
API エンドポイントのリファクタリングを計画しているので、
現状の技術的負債を特定し、優先順位付きの改善計画が欲しいです。
```

**優れている点**:

- 範囲が適切（特定のディレクトリ）
- レビューの目的が明確（リファクタリング計画）
- 期待する成果物が具体的（優先順位付き改善計画）

---

## 対象指定の良い例・悪い例

### ❌ 悪い例 1: 不正確なパス

```
対象: user-service
```

**問題点**:

- 相対パスか絶対パスか不明
- 拡張子がない
- 複数のファイルが該当する可能性

### ✅ 良い例 1: 正確なパス

```
対象: src/services/user-service.ts
```

**優れている点**:

- 正確なファイルパス
- 拡張子を含む
- 一意に特定できる

---

### ❌ 悪い例 2: 除外すべきファイルを指定していない

```
対象: プロジェクトルート
```

**問題点**:

- node_modules や dist などの不要なファイルを含む
- ビルド成果物をレビュー対象にしてしまう
- レビュー時間が無駄に長くなる

### ✅ 良い例 2: 適切な除外指定

```
対象: プロジェクトルート
除外: node_modules/, dist/, coverage/, .next/
注: src/ ディレクトリ配下のソースコードのみをレビュー対象としたい
```

**優れている点**:

- 除外すべきディレクトリを明示
- レビュー対象の意図が明確
- 効率的なレビューが可能

---

## 期待値設定の良い例・悪い例

### ❌ 悪い例 1: 期待が不明確

```
状況: コードを書いた
期待: 問題がないか確認
```

**問題点**:

- 「問題」が何を指すか不明確
- レビューの観点が不明
- どのような結果が欲しいか分からない

### ✅ 良い例 1: 明確な期待値

```
状況: 支払い処理機能を実装（初めてのStripe連携）
期待:
- セキュリティ上の問題がないか
- エラーハンドリングが適切か
- トランザクション処理に競合状態がないか
- 重要度順の改善提案
```

**優れている点**:

- 具体的なレビュー観点を列挙
- 実装背景が明確（初めての Stripe 連携）
- 期待する成果物が明確（重要度順の改善提案）

---

### ❌ 悪い例 2: 現実的でない期待

```
期待: すべての問題を今すぐ完璧に修正したい
```

**問題点**:

- 現実的でない期待
- リソースと時間の制約を考慮していない
- 段階的改善の視点がない

### ✅ 良い例 2: 現実的な期待

```
期待:
- Critical/High 優先度の問題を特定
- Phase 1-3 の段階的な改善計画
- 各改善の工数見積もり（XS/S/M/L/XL）
- トレードオフ分析（どの改善を優先すべきか）

制約:
- 今週中に Critical 問題のみ対応可能
- High/Medium は次スプリントで対応予定
```

**優れている点**:

- 優先順位を考慮
- 段階的改善を前提
- 制約条件を明示
- 現実的なスケジュール感

---

## 改善実施の良い例・悪い例

### ❌ 悪い例 1: すべて一度に修正

```
ユーザー: レポートのすべての改善を今すぐ実施して
```

**問題点**:

- リスクが高い（大規模変更）
- テストが困難
- 問題が発生した時の切り分けが難しい
- チームレビューの時間が取れない

### ✅ 良い例 1: 段階的な実施

```
ユーザー: まず Critical 問題の #1, #2 を修正してください。
修正後、テストを実行して問題ないことを確認したら、
次に High 優先度の #3 を進めましょう。
```

**優れている点**:

- 段階的なアプローチ
- 各段階で検証
- リスクを最小化
- 問題の早期発見が可能

---

### ❌ 悪い例 2: レポートを無視

```
ユーザー: レポートは見たけど、自分の判断で修正する
```

**問題点**:

- トレードオフ分析を無視
- 優先順位を考慮していない
- 全体最適より部分最適

### ✅ 良い例 2: レポートを活用

```
ユーザー: レポートの Phase 1 の Critical 問題から着手します。
ただし、#2 の「関数分割」については、
パフォーマンスへの影響が心配なので、
ベンチマークを取ってから判断したいです。
```

**優れている点**:

- レポートの優先順位を尊重
- プロジェクト固有の事情を考慮
- データに基づく判断を提案
- バランスの取れたアプローチ

---

## レビュー後のフォローアップ

### ❌ 悪い例: レビュー実施後、放置

```
ユーザー: レビューありがとう
（その後、改善を実施せず放置）
```

**問題点**:

- レビューの価値が失われる
- 技術的負債が蓄積
- 次回レビュー時に同じ問題を指摘される

### ✅ 良い例: 継続的な改善

```
ユーザー: Phase 1 の Critical 問題を修正しました。
もう一度レビューして、問題が解決されているか確認してください。

（1週間後）
ユーザー: Phase 2 の High 優先度の改善に取り組みます。
特に #5 の「型安全性の向上」から始めたいです。

（1ヶ月後）
ユーザー: 前回のレビュー後、いくつか改善を実施しました。
改善効果を確認するため、再度レビューをお願いします。
```

**優れている点**:

- 段階的に改善を実施
- 各段階で検証
- 改善効果を測定
- 継続的な品質向上

---

## コンテキストに応じた使い分け

### シナリオ 1: 新機能リリース前

**推奨アプローチ**:

```
対象: 新機能に関連するファイルのみ
優先: セキュリティ、バグ、データ整合性
期限: リリース前に Critical のみ対応
```

**理由**: リリース期限があるため、致命的な問題に焦点を絞る

---

### シナリオ 2: リファクタリング計画

**推奨アプローチ**:

```
対象: リファクタリング対象のディレクトリ
優先: 設計、保守性、技術的負債
期限: 段階的に実施（2-3ヶ月計画）
```

**理由**: 時間に余裕があるため、設計面の改善も含める

---

### シナリオ 3: インシデント後の再発防止

**推奨アプローチ**:

```
対象: インシデント関連のコード
優先: 根本原因の特定、類似問題の検出
期限: 即座に対応（Critical）、その後段階的に改善
```

**理由**: 再発防止が最優先、ただし同様の問題がないかも確認

---

### シナリオ 4: 定期的な品質監査

**推奨アプローチ**:

```
対象: プロジェクト全体（または主要モジュール）
優先: バランスよくすべての観点
期限: 四半期ごとの継続的改善
```

**理由**: 定期的な健全性チェック、長期的な品質維持

---

## まとめ: 効果的なレビューのポイント

### ✅ レビュー前

1. **明確な目的**: なぜレビューが必要か
2. **具体的な対象**: 何をレビューするか
3. **現実的な期待**: どのような結果が欲しいか
4. **制約条件**: 時間、リソース、優先順位

### ✅ レビュー中

1. **レポートを熟読**: 各問題の背景を理解
2. **トレードオフを考慮**: 相反する提案の調整
3. **質問する**: 不明点や疑問があれば確認
4. **プロジェクト固有の事情を共有**: 一般論だけでなく、具体的な状況を考慮

### ✅ レビュー後

1. **優先順位に従って実施**: Critical → High → Medium → Low
2. **段階的に改善**: すべてを一度に変更しない
3. **各段階で検証**: テストとレビューを忘れずに
4. **効果を測定**: 改善の効果を定量的に評価
5. **継続的な改善**: 定期的にレビューを実施

---

このガイドを参考に、reviewing-code スキルを効果的に活用してください。
