---
name: testing-with-playwright
description: PlaywrightMCPサーバーを使用してWebアプリケーションの機能検証、E2Eテスト、デバッグを実行する。「動作検証」「機能テスト」「E2Eテスト」「ブラウザ自動化」「UI検証」「デバッグ」などの依頼時、または新機能実装後の動作確認が必要な時に使用
---

## Playwrightによる動作検証システム

このスキルは、PlaywrightMCPサーバーを使用して、Webアプリケーションの機能検証、E2Eテスト、デバッグを実行します。ブラウザ自動化により、ユーザー操作を再現し、期待通りの動作を確認します。

## 使用例

### 例1: 新機能の動作検証

```
対象: チケット発行機能
状況: 新機能実装後の動作確認
期待: ユーザーフローの正常動作とエラーハンドリングの検証
```

### 例2: バグ再現とデバッグ

```
対象: ログイン機能
状況: ログイン後にダッシュボードが表示されないという報告
期待: 問題の再現、原因特定、修正検証
```

### 例3: レスポンシブデザイン検証

```
対象: ECサイトの商品ページ
状況: モバイル対応の確認
期待: 各デバイスサイズでのレイアウトとインタラクション検証
```

## 主要機能

### 1. ブラウザ自動化とインタラクション

PlaywrightMCPツールを使用した基本操作：

- **ページナビゲーション**: `browser_navigate`, `browser_navigate_back`, `browser_navigate_forward`
- **要素操作**: `browser_click`, `browser_type`, `browser_hover`, `browser_drag`
- **フォーム入力**: `browser_fill_form`, `browser_file_upload`
- **キーボード操作**: `browser_press_key`
- **セレクト操作**: `browser_select_option`

### 2. 検証とデバッグ

動作確認とトラブルシューティング：

- **視覚的検証**: `browser_take_screenshot`, `browser_snapshot`
- **コンソールログ**: `browser_console_messages`
- **ネットワーク監視**: `browser_network_requests`
- **ダイアログ処理**: `browser_handle_dialog`

### 3. 動的要素とタイミング制御

非同期処理と動的コンテンツの扱い：

- **待機処理**: `browser_wait_for`
- **タブ管理**: `browser_tab_list`, `browser_tab_new`, `browser_tab_select`, `browser_tab_close`
- **ビューポート調整**: `browser_resize`

### 4. 高度な操作

JavaScript実行とカスタマイズ：

- **スクリプト実行**: `browser_evaluate`
- **ブラウザ制御**: `browser_install`, `browser_close`

**詳細なテスト手法**: `./TESTING_GUIDE.md` を参照

## 実行手順（検証付きワークフロー）

### ステップ1: テストシナリオの準備

- **入力**:
  - テスト対象のURL
  - 検証したいユーザーフロー
  - 期待する動作と結果
- **検証**:
  - 対象URLがアクセス可能であることを確認
  - 必要な認証情報が揃っていることを確認
- **エラー時**: URL不正または認証情報不足の場合、ユーザーに確認

### ステップ2: ブラウザ環境のセットアップ

- **実行**:
  - 必要に応じて `browser_install` でPlaywrightをインストール
  - `browser_navigate` で対象URLに移動
  - `browser_resize` で適切な画面サイズを設定
- **検証**:
  - ページが正常に読み込まれたことを確認
  - `browser_take_screenshot` で初期状態を記録
- **エラー時**: ページ読み込み失敗時は詳細なエラーログを取得

### ステップ3: ユーザーフローの実行

- **実行**:
  - シナリオに沿って各操作を順次実行
  - 各ステップでスクリーンショットを取得
  - `browser_console_messages` でエラーログを監視
- **検証**:
  - 各操作が成功したことを確認
  - 期待する要素が表示されていることを確認
  - 必要に応じて `browser_wait_for` で要素の出現を待機
- **エラー時**: 操作失敗時はスクリーンショットとコンソールログを取得して報告

### ステップ4: 結果の検証とレポート作成

- **実行**:
  - 最終状態のスクリーンショットを取得
  - `browser_network_requests` でAPI呼び出しを確認
  - `browser_snapshot` でページ構造を記録
- **検証**:
  - 期待する結果と実際の結果を比較
  - エラーや警告がないことを確認
- **出力**: `./REPORT_TEMPLATE.md` の形式で検証結果を報告

**詳細なデバッグ手法**: `./DEBUGGING_GUIDE.md` を参照

### ステップ5: クリーンアップ

- **実行**:
  - `browser_close` でブラウザを終了
  - テスト結果を整理して保存
- **検証**:
  - すべてのリソースが適切に解放されたことを確認

### ステップ6: 失敗時の改善ループ（オプション）

- **条件**: テストが失敗した場合、または期待する結果が得られなかった場合
- **実行**:
  1. 失敗原因を特定（`./DEBUGGING_GUIDE.md` 参照）
  2. 問題の修正を適用（コードまたはテストシナリオの調整）
  3. ステップ1から再実行
- **検証**:
  - すべてのテストが成功するまで繰り返し
  - 修正後も問題が解決しない場合は、より詳細なデバッグ情報を収集
- **終了条件**: すべての検証項目が成功した時点で完了

## デフォルト設定

ユーザーから特別な指示がない限り、以下のデフォルト設定で実行：

### ブラウザ設定

- **ブラウザサイズ**: 1280x720（デスクトップ標準）
- **タイムアウト**: 30秒（要素待機時間）
- **スクリーンショット**: 各主要ステップで自動取得

### 実行方式

- **エラーハンドリング**: エラー発生時は詳細ログとスクリーンショットを取得して続行
- **待機戦略**: 動的要素は最大30秒待機、見つからない場合はエラー報告
- **コンソールログ**: すべてのログレベル（error, warning, info）を記録

### レポート形式

- **形式**: Markdown形式の検証レポート
- **含まれる情報**:
  - 実行サマリー（成功/失敗、実行時間）
  - 各ステップの詳細（スクリーンショット付き）
  - 検出されたエラーと警告
  - ネットワークリクエスト情報
  - 改善提案と次のアクション

**詳細な実行例**: `./EXAMPLES.md` を参照

## 前提条件

このスキルを使用するには、**PlaywrightMCPサーバー**が設定されている必要があります。

### セットアップ手順

1. **MCPサーバーの設定**

   `.claude/mcp.json`にPlaywrightMCPサーバーを追加：

   ```json
   {
     "mcpServers": {
       "playwright": {
         "command": "npx",
         "args": ["-y", "@executeautomation/playwright-mcp-server"]
       }
     }
   }
   ```

2. **Claude Codeの再起動**

   MCPサーバー設定後、Claude Codeを再起動してサーバーを読み込みます。

3. **Playwrightのインストール（初回のみ）**

   初回実行時は`browser_install`ツールでPlaywrightをインストール：
   ```
   browser_install()
   ```

### 動作確認

MCPサーバーが正常に設定されているか確認：
- Claude Codeで`browser_`で始まるツールが利用可能になっていることを確認
- 利用可能なPlaywrightMCPツール一覧は`./TESTING_GUIDE.md`を参照

**参考**: PlaywrightMCPサーバーの詳細は[公式ドキュメント](https://github.com/executeautomation/playwright-mcp-server)を参照してください。

## 注意事項

1. **アクセス制限**: 認証が必要なページの場合、事前に認証情報を提供してください
2. **パフォーマンス**: 大規模なテストは時間がかかる場合があります
3. **動的コンテンツ**: SPAやAjaxを多用するアプリケーションは適切な待機時間が必要です
4. **ブラウザ互換性**: PlaywrightはChromium、Firefox、WebKitをサポートしています
5. **ネットワーク環境**: 外部APIに依存する機能は、ネットワーク状態に影響を受けます

このスキルにより、手動テストの自動化、バグの再現と検証、継続的な品質保証を実現できます。
