---
name: researching-cloudflare-resources
description: cloudflare-mcp-server を活用して Cloudflare のリソース情報を取得・分析する。ゾーン設定、DNS レコード、Workers 設定、Analytics データ、ファイアウォールルールなどの調査を正確にサポート。「リソース確認」「設定情報取得」「Analytics分析」「DNSレコード確認」「Workers情報」などの依頼時に使用
---

## Cloudflare リソース調査スキル

このスキルは、`cloudflare:mcp-server-cloudflare` を使用して、Cloudflare のリソース情報を取得し、現在の設定状態を分析します。推測や記憶に頼らず、常に MCP サーバー経由で最新の情報を取得します。

## 使用例

### 例1: ゾーン設定の確認

```
状況: 現在のゾーン設定を確認したい
要求: SSL/TLS 設定、キャッシュ設定、セキュリティ設定
期待: 現在の設定値、推奨設定との比較、改善提案
```

### 例2: DNS レコードの取得

```
状況: DNS レコードを確認して問題がないかチェック
要求: A/AAAA/CNAME/MX レコードの一覧と検証
期待: レコード一覧、設定ミスの検出、修正提案
```

### 例3: Analytics データの分析

```
状況: トラフィックパターンとパフォーマンスを分析
要求: 過去7日間のリクエスト数、帯域幅、キャッシュヒット率
期待: データの可視化、傾向分析、最適化提案
```

## 基本原則

### 1. MCP サーバー駆動

すべての調査は、`cloudflare:mcp-server-cloudflare` を通じて取得したリアルタイム情報に基づいて行います。

**必須ルール**:
- すべての回答は MCP サーバーから取得したデータに基づく
- 推測や記憶に頼らない
- データの取得元（MCP ツール名）を明示

### 2. 正確性の最優先

**検証項目**:
- API レスポンスの構造を確認
- 設定値の妥当性を検証
- エラーや警告がないか確認

### 3. 情報の鮮度

**確認事項**:
- MCP サーバーから最新データを取得
- キャッシュされたデータではないことを確認
- 定期的な再確認を推奨

## リソース調査ワークフロー

### ステップ1: 調査対象の明確化

**調査対象の分類**:
1. ゾーン設定（SSL/TLS、キャッシュ、セキュリティ）
2. DNS レコード（A、AAAA、CNAME、MX 等）
3. Workers/Pages 設定（Routes、環境変数、バインディング）
4. ファイアウォールルール（WAF、Rate Limiting、Firewall Rules）
5. Analytics データ（トラフィック、パフォーマンス、エラー率）

### ステップ2: MCP ツールでデータ取得

**使用する MCP ツール**:
- ゾーン設定取得
- DNS レコード取得
- Workers 設定確認
- Analytics データ取得
- ファイアウォールルール確認

**データ取得時の注意**:
- API レート制限を考慮
- エラーハンドリング
- 必要なデータのみ取得

### ステップ3: データ分析と評価

**分析観点**:
- 設定の妥当性（ベストプラクティスとの比較）
- セキュリティリスクの検出
- パフォーマンスボトルネックの特定
- コスト最適化の機会

### ステップ4: 結果の構造化と回答

**回答形式**:
1. **現状**: 取得したデータの要約
2. **分析**: データから読み取れる傾向や問題点
3. **推奨事項**: ベストプラクティスに基づく改善提案
4. **参照元**: 使用した MCP ツール名

**データ参照の明示**:
```
📊 **データ取得元**: cloudflare:mcp-server-cloudflare
🔧 **使用ツール**: ゾーン設定取得
📅 **取得日時**: 2025-01-31 12:00:00 UTC
```

## 調査カテゴリ別の手法

### 1. ゾーン設定の調査

**調査対象**:
- SSL/TLS 設定（暗号化モード、TLS バージョン）
- キャッシュ設定（TTL、Page Rules）
- セキュリティ設定（WAF、DDoS Protection）
- パフォーマンス設定（Argo、HTTP/3、圧縮）

**MCP ツール**:
- ゾーン設定取得

**回答例**:
```markdown
## ゾーン設定の現状

📊 **データ取得元**: cloudflare:mcp-server-cloudflare

### SSL/TLS 設定
- **暗号化モード**: Full (strict)
- **TLS バージョン**: 1.2 以上
- **HSTS**: 有効

### 推奨事項
- TLS 1.3 への移行を推奨（現在: TLS 1.2）
- Always Use HTTPS を有効化
```

### 2. DNS レコードの調査

**調査対象**:
- A/AAAA レコード（IPv4/IPv6）
- CNAME レコード（エイリアス）
- MX レコード（メール）
- TXT レコード（SPF、DKIM、DMARC）

**MCP ツール**:
- DNS レコード取得

**回答例**:
```markdown
## DNS レコード一覧

📊 **データ取得元**: cloudflare:mcp-server-cloudflare
🔧 **使用ツール**: DNS レコード取得

| タイプ | 名前 | 値 | プロキシ |
|--------|------|-----|----------|
| A | example.com | 192.0.2.1 | 有効 |
| CNAME | www | example.com | 有効 |
| MX | @ | mail.example.com (10) | 無効 |

### 推奨事項
- MX レコードのプロキシを無効化済み（正常）
- SPF レコードの追加を推奨
```

### 3. Workers 設定の調査

**調査対象**:
- Workers Routes
- 環境変数とシークレット
- KV/D1/R2 バインディング
- Cron Triggers

**MCP ツール**:
- Workers 設定確認

### 4. Analytics データの調査

**調査対象**:
- トラフィック（リクエスト数、帯域幅）
- パフォーマンス（TTFB、キャッシュヒット率）
- エラー率（HTTP ステータスコード別）
- セキュリティ（攻撃検出数）

**MCP ツール**:
- Analytics データ取得

**回答例**:
```markdown
## Analytics サマリー（過去7日間）

📊 **データ取得元**: cloudflare:mcp-server-cloudflare
📅 **期間**: 2025-01-24 ~ 2025-01-31

### トラフィック
- 総リクエスト数: 1,234,567
- 総帯域幅: 45.6 GB
- ユニーク訪問者: 98,765

### パフォーマンス
- キャッシュヒット率: 87%（目標: 90%以上）
- 平均 TTFB: 120ms

### 推奨事項
- キャッシュヒット率向上のため Page Rules を見直し
- 静的アセットの Cache-Control ヘッダーを最適化
```

### 5. ファイアウォールルールの調査

**調査対象**:
- WAF マネージドルール
- カスタムファイアウォールルール
- Rate Limiting ルール
- Bot Management 設定

**MCP ツール**:
- ファイアウォールルール確認

## MCP ツール使用リファレンス

このスキルで使用する MCP ツールの詳細は `./MCP_TOOLS.md` を参照してください。

### 利用可能なツール

1. **ゾーン設定取得**: 全般的なゾーン設定の取得
2. **DNS レコード取得**: DNS レコード一覧の取得
3. **Workers 設定確認**: Workers の設定とルートの確認
4. **Analytics データ取得**: トラフィックとパフォーマンスデータ
5. **ファイアウォールルール確認**: セキュリティルールの取得

## デフォルト設定

ユーザーから特別な指示がない限り、以下のデフォルト設定でリソース調査を進めます：

### データ取得設定

| 項目 | デフォルト値 | 説明 |
|------|-------------|------|
| データ範囲 | 全ゾーン | 特定ゾーンに絞る場合は指定 |
| Analytics 期間 | 過去7日間 | カスタム期間指定可能 |
| 詳細レベル | サマリー | 詳細データが必要な場合は指定 |

### 検索戦略

| 項目 | デフォルト値 | 説明 |
|------|-------------|------|
| リソース種別 | 自動判別 | ユーザーの依頼から推測 |
| フィルタリング | 有効なリソースのみ | 削除済みリソースは除外 |
| ソート順 | 作成日時降順 | 最新のリソースから表示 |

### 回答形式

| 項目 | デフォルト値 | 説明 |
|------|-------------|------|
| データ取得元明示 | 必須 | MCP ツール名を含める |
| テーブル形式 | 推奨 | 一覧表示に使用 |
| 推奨事項 | 含める | ベストプラクティスとの比較 |

### パフォーマンス

| 項目 | デフォルト値 | 説明 |
|------|-------------|------|
| 並列取得 | 有効 | 複数リソース取得時に並列化 |
| キャッシュ | なし | 常に最新データを取得 |
| レート制限対応 | 自動リトライ | 制限到達時は待機後再試行 |

## エラーハンドリング

### MCP サーバーが利用できない場合

**対応方法**:
1. エラーメッセージをユーザーに伝達
2. 代替手段（Dashboard、API 直接呼び出し）を提案
3. 一般的な知識での回答は避ける（データに基づかないため）

**回答例**:
```markdown
⚠️ **エラー**: cloudflare-mcp-server に接続できません

MCP サーバーが利用できないため、リアルタイムデータの取得ができません。
以下の代替手段をお試しください：

1. Cloudflare Dashboard で直接確認
2. wrangler CLI を使用（`wrangler zones list`）
3. Cloudflare API を直接呼び出し
```

### API レート制限に達した場合

**対応方法**:
1. 待機時間をユーザーに伝達
2. データ取得の優先順位を確認
3. キャッシュされたデータの使用を提案

## 依存関係

このスキルが正常に動作するために必要な依存関係：

### 必須依存関係

- **cloudflare-mcp-server** (`cloudflare:mcp-server-cloudflare`)
  - Cloudflare リソース情報の取得に使用
  - 使用するツール:
    - ゾーン設定取得
    - DNS レコード取得
    - Workers 設定確認
    - Analytics データ取得
    - ファイアウォールルール確認

### オプション依存関係

なし（このスキルは MCP サーバーのみに依存）

### 関連スキル

- `developing-cloudflare-solutions`: 調査後の実装支援
- `reviewing-cloudflare-infrastructure`: リソース情報に基づくレビュー

## 注意事項

1. **MCP サーバー依存**: すべての調査は MCP サーバー経由で実行
2. **API レート制限**: Cloudflare API のレート制限を考慮
3. **リアルタイムデータ**: 常に最新データを取得（キャッシュ非推奨）
4. **権限**: MCP サーバーの API トークンに適切な権限が必要
5. **データ機密性**: 取得したデータには機密情報が含まれる可能性

## 実装支援との連携

リソース調査後、設定変更や実装が必要な場合は `developing-cloudflare-solutions` スキルを使用してください。

このスキルにより、Cloudflare リソース情報を正確かつ効率的に取得し、データに基づいた意思決定をサポートできます。
